{% extends "base.html" %}

{% block title %}Extrato PJ Local - Consciência Café{% endblock %}

{% block content %}
<style>
    /* Estilos específicos para versão local */
    .local-badge {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
    }
    .fonte-local {
        border-left: 4px solid #28a745;
        background-color: rgba(40, 167, 69, 0.1);
    }
</style>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-bank"></i> Extrato Pessoa Jurídica
        <span class="local-badge">
            <i class="bi bi-database"></i> LOCAL
        </span>
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="/local" class="btn btn-outline-secondary me-2">
            <i class="bi bi-house"></i> Dashboard
        </a>
        <button class="btn btn-success me-2" onclick="abrirModalBusca()">
            <i class="bi bi-search"></i> Buscar
        </button>
        <button class="btn btn-primary" onclick="exportarExtrato()">
            <i class="bi bi-download"></i> Exportar
        </button>
    </div>
</div>

<!-- Alerta de Fonte Local -->
<div class="alert fonte-local">
    <i class="bi bi-database"></i>
    <strong>Dados Locais:</strong> Extratos carregados do banco SQLite local.
    <small class="ms-2" id="fonteInfo">Aguardando consulta...</small>
</div>

<!-- Filtros -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="bi bi-funnel"></i> Filtros
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3">
                <label for="selectConta" class="form-label">Conta</label>
                <select class="form-select" id="selectConta">
                    <option value="">Carregando contas...</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="dataInicio" class="form-label">Data Início</label>
                <input type="date" class="form-control" id="dataInicio">
            </div>
            <div class="col-md-3">
                <label for="dataFim" class="form-label">Data Fim</label>
                <input type="date" class="form-control" id="dataFim">
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button class="btn btn-primary me-2" onclick="carregarExtrato()">
                    <i class="bi bi-search"></i> Filtrar
                </button>
                <button class="btn btn-outline-secondary" onclick="limparFiltros()">
                    <i class="bi bi-arrow-clockwise"></i> Limpar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Resumo -->
<div class="row mb-4" id="resumoCards" style="display: none;">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title text-success">
                    <i class="bi bi-arrow-up-circle"></i> Créditos
                </h5>
                <h3 class="text-success" id="totalCreditos">R$ 0,00</h3>
                <small class="text-muted" id="qtdCreditos">0 lançamentos</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title text-danger">
                    <i class="bi bi-arrow-down-circle"></i> Débitos
                </h5>
                <h3 class="text-danger" id="totalDebitos">R$ 0,00</h3>
                <small class="text-muted" id="qtdDebitos">0 lançamentos</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title text-primary">
                    <i class="bi bi-calculator"></i> Saldo Período
                </h5>
                <h3 id="saldoPeriodo">R$ 0,00</h3>
                <small class="text-muted" id="periodo">-</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title text-info">
                    <i class="bi bi-list-ul"></i> Total Lançamentos
                </h5>
                <h3 class="text-info" id="totalLancamentos">0</h3>
                <small class="text-muted" id="contaAtual">-</small>
            </div>
        </div>
    </div>
</div>

<!-- Loading -->
<div class="loading" id="loadingSpinner" style="display: none;">
    <div class="spinner-border" role="status">
        <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2 text-muted">Carregando extrato local...</p>
</div>

<!-- Mensagem inicial -->
<div class="card" id="mensagemInicial">
    <div class="card-body text-center py-5">
        <i class="bi bi-database display-1 text-success mb-3"></i>
        <h5 class="text-muted">Selecione uma conta e período para visualizar o extrato</h5>
        <p class="text-muted">Use os filtros acima para carregar os dados financeiros locais.</p>
    </div>
</div>

<!-- Tabela de Extrato -->
<div class="card" id="extratoCard" style="display: none;">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
            <i class="bi bi-table"></i> Extrato Detalhado
            <span class="badge bg-success ms-2" id="badgeFonte">LOCAL</span>
        </h5>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="mostrarApenasConciliados">
            <label class="form-check-label" for="mostrarApenasConciliados">
                Apenas Conciliados
            </label>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Data</th>
                        <th>Descrição</th>
                        <th>Categoria</th>
                        <th>Cliente/Fornecedor</th>
                        <th>Tipo</th>
                        <th class="text-end">Valor</th>
                        <th class="text-end">Saldo</th>
                        <th class="text-center">Status</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody id="extratoTableBody">
                    <!-- Dados serão inseridos via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal de Busca -->
<div class="modal fade" id="modalBusca" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-search"></i> Buscar Transações
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="searchQuery" class="form-label">Buscar por descrição:</label>
                    <input type="text" class="form-control" id="searchQuery" placeholder="Digite pelo menos 3 caracteres...">
                </div>
                <div class="mb-3">
                    <label for="searchConta" class="form-label">Filtrar por conta (opcional):</label>
                    <select class="form-select" id="searchConta">
                        <option value="">Todas as contas</option>
                    </select>
                </div>
                <div id="searchResults">
                    <!-- Resultados da busca -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-primary" onclick="executarBusca()">
                    <i class="bi bi-search"></i> Buscar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalhes (reutilizando do template original) -->
<div class="modal fade" id="modalDetalhes" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-info-circle"></i> Detalhes do Lançamento
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalDetalhesContent">
                <!-- Conteúdo será inserido via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    let extratoAtual = [];
    let contasDisponiveis = [];

    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        carregarContas();
        definirDatasDefault();
        restaurarUltimoFiltro();
    });

    function definirDatasDefault() {
        const hoje = new Date();
        const trintaDiasAtras = new Date();
        trintaDiasAtras.setDate(hoje.getDate() - 30);

        document.getElementById('dataFim').value = hoje.toISOString().split('T')[0];
        document.getElementById('dataInicio').value = trintaDiasAtras.toISOString().split('T')[0];
    }

    async function carregarContas() {
        try {
            const response = await axios.get('/api/local/contas-disponiveis');

            if (response.data.success) {
                contasDisponiveis = response.data.contas;
                const select = document.getElementById('selectConta');
                const searchSelect = document.getElementById('searchConta');

                select.innerHTML = '';
                searchSelect.innerHTML = '<option value="">Todas as contas</option>';

                // Adicionar opção padrão
                const optionDefault = document.createElement('option');
                optionDefault.value = '';
                optionDefault.textContent = 'Selecione uma conta...';
                select.appendChild(optionDefault);

                // Separar contas ativas e inativas
                const contasAtivas = contasDisponiveis.filter(conta => conta.ativo !== false);
                const contasInativas = contasDisponiveis.filter(conta => conta.ativo === false);

                // Adicionar contas ativas
                contasAtivas.forEach(conta => {
                    // Select principal
                    const option = document.createElement('option');
                    option.value = conta.id;
                    option.textContent = conta.nome;
                    select.appendChild(option);

                    // Select de busca
                    const searchOption = document.createElement('option');
                    searchOption.value = conta.id;
                    searchOption.textContent = conta.nome;
                    searchSelect.appendChild(searchOption);
                });

                // Adicionar contas inativas com indicação visual
                if (contasInativas.length > 0) {
                    // Separador no select principal
                    const separador = document.createElement('optgroup');
                    separador.label = 'Contas Inativas';
                    select.appendChild(separador);

                    contasInativas.forEach(conta => {
                        // Select principal
                        const option = document.createElement('option');
                        option.value = conta.id;
                        option.textContent = `${conta.nome} (INATIVA)`;
                        option.style.color = '#6c757d';
                        option.style.fontStyle = 'italic';
                        separador.appendChild(option);

                        // Select de busca
                        const searchOption = document.createElement('option');
                        searchOption.value = conta.id;
                        searchOption.textContent = `${conta.nome} (INATIVA)`;
                        searchSelect.appendChild(searchOption);
                    });
                }

                // Atualizar info da fonte
                const infoTexto = `${contasAtivas.length} contas ativas, ${contasInativas.length} inativas - Fonte: ${response.data.fonte}`;
                document.getElementById('fonteInfo').textContent = infoTexto;

                // Se veio com parâmetro na URL, pré-selecionar e carregar extrato
                const params = new URLSearchParams(window.location.search);
                const contaParam = params.get('conta');
                if (contaParam) {
                    const optionExists = [...select.options].some(opt => opt.value === contaParam);
                    if (optionExists) {
                        select.value = contaParam;
                        searchSelect.value = contaParam;
                        setTimeout(() => carregarExtrato(), 150);
                    }
                }
            }
        } catch (error) {
            console.error('Erro ao carregar contas:', error);
            mostrarAlerta('Erro ao carregar contas disponíveis', 'danger');
        }
    }

    async function carregarExtrato() {
        const loadingSpinner = document.getElementById('loadingSpinner');
        const extratoCard = document.getElementById('extratoCard');
        const resumoCards = document.getElementById('resumoCards');
        const mensagemInicial = document.getElementById('mensagemInicial');

        // Salvar filtro atual
        salvarUltimoFiltro();

        // Mostrar loading e esconder outros elementos
        loadingSpinner.style.display = 'block';
        extratoCard.style.display = 'none';
        resumoCards.style.display = 'none';
        mensagemInicial.style.display = 'none';

        try {
            const contaId = document.getElementById('selectConta').value;
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;

            // Validar se uma conta foi selecionada
            if (!contaId) {
                mostrarAlerta('Por favor, selecione uma conta antes de filtrar.', 'warning');
                loadingSpinner.style.display = 'none';
                mensagemInicial.style.display = 'block';
                return;
            }

            // Converter datas para formato brasileiro
            const dataInicioFormatada = dataInicio ? formatDateBR(dataInicio) : '';
            const dataFimFormatada = dataFim ? formatDateBR(dataFim) : '';

            const params = new URLSearchParams({
                conta_id: contaId,
                data_inicio: dataInicioFormatada,
                data_fim: dataFimFormatada,
                pagina: 1,
                _t: Date.now()
            });

            const response = await axios.get(`/api/local/extrato-conta-corrente?${params}`);

            if (response.data.success) {
                extratoAtual = response.data.extrato;
                atualizarResumo(response.data.resumo, response.data.conta_info);
                renderizarExtrato(extratoAtual);

                // Atualizar badge da fonte
                document.getElementById('badgeFonte').textContent =
                    response.data.fonte === 'local_database' ? 'LOCAL' : 'OMIE';

                // Mostrar cards e tabela
                resumoCards.style.display = 'flex';
                extratoCard.style.display = 'block';
            } else {
                mostrarAlerta('Erro: ' + response.data.error, 'danger');
            }
        } catch (error) {
            console.error('Erro ao carregar extrato:', error);
            mostrarAlerta('Erro ao carregar extrato local. Verifique a conexão.', 'danger');
            mensagemInicial.style.display = 'block';
        } finally {
            loadingSpinner.style.display = 'none';
        }
    }

    // Funções de busca
    function abrirModalBusca() {
        const modal = new bootstrap.Modal(document.getElementById('modalBusca'));
        modal.show();
    }

    async function executarBusca() {
        const query = document.getElementById('searchQuery').value;
        const contaId = document.getElementById('searchConta').value;

        if (!query || query.length < 3) {
            mostrarAlerta('Digite pelo menos 3 caracteres para buscar', 'warning');
            return;
        }

        try {
            const params = new URLSearchParams({
                q: query,
                limit: 50
            });

            if (contaId) {
                params.append('conta_id', contaId);
            }

            const response = await axios.get(`/api/local/buscar-transacoes?${params}`);

            if (response.data.success) {
                mostrarResultadosBusca(response.data.transacoes);
            } else {
                mostrarAlerta('Erro na busca: ' + response.data.error, 'danger');
            }
        } catch (error) {
            console.error('Erro na busca:', error);
            mostrarAlerta('Erro ao executar busca', 'danger');
        }
    }

    function mostrarResultadosBusca(transacoes) {
        const resultsDiv = document.getElementById('searchResults');

        if (transacoes.length === 0) {
            resultsDiv.innerHTML = `
                <div class="alert alert-info">
                    <i class="bi bi-search"></i> Nenhuma transação encontrada para esta busca.
                </div>
            `;
            return;
        }

        let html = `
            <div class="alert alert-success">
                <i class="bi bi-check2"></i> Encontradas ${transacoes.length} transações
            </div>
            <div class="table-responsive">
                <table class="table table-sm table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Data</th>
                            <th>Descrição</th>
                            <th>Conta</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        transacoes.forEach(trans => {
            const valor = parseFloat(trans.amount);
            const valorFormatado = valor.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });

            html += `
                <tr>
                    <td>${trans.date}</td>
                    <td>${trans.description}</td>
                    <td>${trans.account_name || 'N/A'}</td>
                    <td class="text-end ${trans.type === 'credit' ? 'text-success' : 'text-danger'}">
                        ${trans.type === 'credit' ? '+' : '-'} ${valorFormatado}
                    </td>
                </tr>
            `;
        });

        html += '</tbody></table></div>';
        resultsDiv.innerHTML = html;
    }

    // Reutilizar funções do template original com adaptações
    function atualizarResumo(resumo, contaInfo) {
        document.getElementById('totalCreditos').textContent = resumo.total_creditos_formatado;
        document.getElementById('totalDebitos').textContent = resumo.total_debitos_formatado;
        document.getElementById('saldoPeriodo').textContent = resumo.saldo_periodo_formatado;
        document.getElementById('totalLancamentos').textContent = resumo.total_lancamentos;
        document.getElementById('periodo').textContent = resumo.periodo;
        document.getElementById('contaAtual').textContent = contaInfo.nome;

        // Definir cor do saldo
        const saldoElement = document.getElementById('saldoPeriodo');
        const saldoValor = parseFloat(resumo.saldo_periodo_formatado.replace('R$ ', '').replace('.', '').replace(',', '.'));
        saldoElement.className = saldoValor >= 0 ? 'text-success' : 'text-danger';

        // Contar créditos e débitos
        const qtdCreditos = extratoAtual.filter(item => item.tipo === 'Crédito').length;
        const qtdDebitos = extratoAtual.filter(item => item.tipo === 'Débito').length;
        document.getElementById('qtdCreditos').textContent = `${qtdCreditos} lançamentos`;
        document.getElementById('qtdDebitos').textContent = `${qtdDebitos} lançamentos`;
    }

    function renderizarExtrato(extrato) {
        const tbody = document.getElementById('extratoTableBody');
        const apenasConc = document.getElementById('mostrarApenasConciliados').checked;

        const extratoFiltrado = apenasConc ? extrato.filter(item => item.conciliado) : extrato;

        tbody.innerHTML = '';

        extratoFiltrado.forEach((item, index) => {
            const row = document.createElement('tr');

            row.innerHTML = `
                <td>${item.data}</td>
                <td>
                    <div class="fw-semibold">${truncateText(item.descricao, 40)}</div>
                    ${item.documento ? `<small class="text-muted">Doc: ${item.documento}</small>` : ''}
                </td>
                <td>
                    <span class="badge bg-secondary">${item.categoria}</span>
                </td>
                <td>
                    ${item.cliente ? `<small class="text-muted">${truncateText(item.cliente, 30)}</small>` : '<small class="text-muted">-</small>'}
                </td>
                <td>
                    <span class="badge ${item.tipo === 'Crédito' ? 'bg-success' : 'bg-danger'}">${item.tipo}</span>
                </td>
                <td class="text-end fw-bold ${item.tipo === 'Crédito' ? 'text-success' : 'text-danger'}">
                    ${item.tipo === 'Crédito' ? '+' : '-'} ${item.valor_formatado}
                </td>
                <td class="text-end">${item.saldo_formatado}</td>
                <td class="text-center">
                    ${item.conciliado ?
                        '<i class="bi bi-check-circle-fill text-success" title="Conciliado"></i>' :
                        '<i class="bi bi-exclamation-circle text-warning" title="Não Conciliado"></i>'
                    }
                </td>
                <td class="text-center">
                    <button class="btn btn-sm btn-outline-primary" onclick="mostrarDetalhes(${index})">
                        <i class="bi bi-eye"></i>
                    </button>
                </td>
            `;

            tbody.appendChild(row);
        });

        if (extratoFiltrado.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center py-4 text-muted">
                        <i class="bi bi-inbox display-6"></i>
                        <p class="mt-2">Nenhum lançamento encontrado para os filtros selecionados</p>
                    </td>
                </tr>
            `;
        }
    }

    // Funções auxiliares (mantidas do template original)
    function mostrarDetalhes(index) {
        const item = extratoAtual[index];
        const modalContent = document.getElementById('modalDetalhesContent');

        modalContent.innerHTML = `
            <div class="row g-3">
                <div class="col-12">
                    <div class="alert alert-info">
                        <i class="bi bi-database"></i> <strong>Fonte:</strong> Banco de dados local
                    </div>
                </div>
                <div class="col-md-6">
                    <strong>Data:</strong> ${item.data}
                </div>
                <div class="col-md-6">
                    <strong>Tipo:</strong>
                    <span class="badge ${item.tipo === 'Crédito' ? 'bg-success' : 'bg-danger'}">${item.tipo}</span>
                </div>
                <div class="col-12">
                    <strong>Descrição:</strong><br>
                    ${item.descricao}
                </div>
                ${item.cliente ? `
                    <div class="col-md-6">
                        <strong>Cliente:</strong><br>
                        ${item.cliente}
                    </div>
                ` : ''}
                <div class="col-md-6">
                    <strong>Categoria:</strong><br>
                    <span class="badge bg-secondary">${item.categoria}</span>
                </div>
                <div class="col-md-6">
                    <strong>Valor:</strong><br>
                    <span class="fw-bold ${item.tipo === 'Crédito' ? 'text-success' : 'text-danger'}">
                        ${item.tipo === 'Crédito' ? '+' : '-'} ${item.valor_formatado}
                    </span>
                </div>
                <div class="col-md-6">
                    <strong>Saldo:</strong> ${item.saldo_formatado}
                </div>
                <div class="col-md-6">
                    <strong>Status:</strong>
                    ${item.conciliado ?
                        '<span class="badge bg-success">Conciliado</span>' :
                        '<span class="badge bg-warning">Não Conciliado</span>'
                    }
                </div>
                ${item.documento ? `
                    <div class="col-md-6">
                        <strong>Documento:</strong> ${item.documento}
                    </div>
                ` : ''}
                <div class="col-12">
                    <strong>Código:</strong> ${item.codigo}
                </div>
            </div>
        `;

        const modal = new bootstrap.Modal(document.getElementById('modalDetalhes'));
        modal.show();
    }

    function truncateText(text, maxLength) {
        return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
    }

    function formatDateBR(dateString) {
        if (!dateString) return '';
        const parts = dateString.split('-');
        if (parts.length !== 3) return dateString;
        return `${parts[2]}/${parts[1]}/${parts[0]}`;
    }

    function limparFiltros() {
        document.getElementById('selectConta').value = '';
        definirDatasDefault();

        const extratoCard = document.getElementById('extratoCard');
        const resumoCards = document.getElementById('resumoCards');
        extratoCard.style.display = 'none';
        resumoCards.style.display = 'none';

        localStorage.removeItem('ultimoFiltroExtrato');
    }

    function exportarExtrato() {
        mostrarAlerta('Funcionalidade de exportação em desenvolvimento', 'info');
    }

    function salvarUltimoFiltro() {
        const filtro = {
            conta_id: document.getElementById('selectConta').value,
            data_inicio: document.getElementById('dataInicio').value,
            data_fim: document.getElementById('dataFim').value
        };
        localStorage.setItem('ultimoFiltroExtrato', JSON.stringify(filtro));
    }

    function restaurarUltimoFiltro() {
        try {
            const params = new URLSearchParams(window.location.search);
            if (params.get('conta')) {
                return;  // Priorizar filtro vindo da URL
            }

            const ultimoFiltro = localStorage.getItem('ultimoFiltroExtrato');
            if (ultimoFiltro) {
                const filtro = JSON.parse(ultimoFiltro);

                setTimeout(() => {
                    if (filtro.conta_id) {
                        document.getElementById('selectConta').value = filtro.conta_id;
                    }
                    if (filtro.data_inicio) {
                        document.getElementById('dataInicio').value = filtro.data_inicio;
                    }
                    if (filtro.data_fim) {
                        document.getElementById('dataFim').value = filtro.data_fim;
                    }

                    if (filtro.conta_id && filtro.data_inicio && filtro.data_fim) {
                        carregarExtrato();
                    }
                }, 1000);
            }
        } catch (error) {
            console.log('Erro ao restaurar último filtro:', error);
        }
    }

    function mostrarAlerta(mensagem, tipo = 'info') {
        const alertContainer = document.createElement('div');
        alertContainer.className = `alert alert-${tipo} alert-dismissible fade show position-fixed`;
        alertContainer.style.cssText = 'top: 20px; right: 20px; z-index: 1050; max-width: 400px;';
        alertContainer.innerHTML = `
            ${mensagem}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        document.body.appendChild(alertContainer);

        setTimeout(() => {
            if (alertContainer.parentNode) {
                alertContainer.parentNode.removeChild(alertContainer);
            }
        }, 5000);
    }

    // Event listeners
    document.getElementById('mostrarApenasConciliados').addEventListener('change', function() {
        renderizarExtrato(extratoAtual);
    });

    document.getElementById('dataInicio').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') carregarExtrato();
    });

    document.getElementById('dataFim').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') carregarExtrato();
    });

    document.getElementById('searchQuery').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') executarBusca();
    });
</script>
{% endblock %}
